// ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
//	Totem
// ╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
// │ I N C L U D E S                                                                                                                                   │
// ╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
//

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/ext_power.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/pointing.h>
#include <input/processors.dtsi>

// ╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
// │ D E F I N I T I O N S                                                                                                                             │
// ╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯


// DEFINE LAYERS
#define Base        0
#define Nav         1
#define Fun         2
#define Game        3
#define Gameplus    4
#define Mouse		5
#define Sys			6


#define XXX &none
#define ___ &trans

#define DSK_PREV  &hmr LCTRL LG(LC(LEFT)) // Previous desktop.
#define DSK_NEXT  &hmr LALT LG(LC(RIGHT)) // Next     desktop.
#define PIN_WIN   &kp LG(LC(LS(Q)))       // Pin window across desktops.
#define PIN_APP   &kp LG(LC(LS(A)))       // Pin application across desktops.

#define NAV_LEFT  &mt_home 0   LEFT  // Tap: left  | Long-tap: start of line.
#define NAV_RIGHT &mt_end 0    RIGHT // Tap: right | Long-tap: end   of line.
#define NAV_UP    &mt LC(HOME) UP    // Tap: up    | Long-tap: start of doc.
#define NAV_DOWN  &mt LC(END)  DOWN  // Tap: down  | Long-tap: end   of doc.
#define NAV_BSPC  &mt LC(BSPC) BSPC  // Tap: bspc  | Long-tap: delete word bwd.
#define NAV_DEL   &mt LC(DEL)  DEL   // Tap: del   | Long-tap: delete word fwd.


// ╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
// │ M A C R O S                                                                                                                                       │
// ╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

&mt {
    quick-tap-ms = <100>;
    global-quick-tap;
    flavor = "tap-preferred";
    tapping-term-ms = <170>;
	};

&lt {
    tapping-term-ms = <240>;
    flavor = "balanced";
    quick-tap-ms = <150>;
	};
	

// SHIFT HELPER - easier re-mapping of shifted characters //
#define DEFINE_SHIFT_KEY(_behavior_name, _normal_key, _shifted_key)         \
    _behavior_name: _behavior_name {                                        \
      compatible = "zmk,behavior-mod-morph";                                \
      #binding-cells = <0>;                                                 \
      bindings = <_normal_key>, <_shifted_key>;                             \
      mods = <(MOD_LSFT|MOD_RSFT)>;                                         \
    };

// TAPDANCE HELPER - one-line tap dance creation //
#define DEFINE_DOUBLE_TAP_KEY(_behavior_name, _normal_key, _double_tap_key) \
    _behavior_name: _behavior_name {                                        \
      compatible = "zmk,behavior-tap-dance";                                \
      #binding-cells = <0>;                                                 \
      tapping-term-ms = <200>;                                              \
      bindings = <_normal_key>, <_double_tap_key>;                          \
    };

// COMBO HELPER - one-line combo creating //
#define COMBO(NAME, BINDINGS, KEYPOS, LAYERS)                               \
  combo_##NAME {                                                            \
    timeout-ms = <50>;                                                      \
    bindings = <BINDINGS>;                                                  \
    key-positions = <KEYPOS>;                                               \
    layers = <LAYERS>;                                                      \
  };
  
&mmv {
    x-input-code = <INPUT_REL_X>;
    y-input-code = <INPUT_REL_Y>;
    time-to-max-speed-ms = <300>;
    acceleration-exponent = <1>;
	};

&msc {
    x-input-code = <INPUT_REL_HWHEEL>;
    y-input-code = <INPUT_REL_WHEEL>;
    time-to-max-speed-ms = <300>;
    acceleration-exponent = <0>;
	};

// ╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
// │ B E H A V I O R S                                                                                                                                 │
// ╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
/ {
    behaviors {
	
	DEFINE_DOUBLE_TAP_KEY(td_par, &kp LPAR, &kp RPAR)
    DEFINE_DOUBLE_TAP_KEY(td_brc, &kp LBRC, &kp RBRC)
    DEFINE_DOUBLE_TAP_KEY(td_bkt, &kp LBKT, &kp RBKT)
    DEFINE_DOUBLE_TAP_KEY(td_lt, &kp LT, &kp GT)
    DEFINE_DOUBLE_TAP_KEY(td_slh, &kp FSLH, &kp BSLH)
    DEFINE_SHIFT_KEY(comma_semi, &kp COMMA, &kp SEMI)
    DEFINE_SHIFT_KEY(dot_colon, &kp DOT, &kp COLON)
    DEFINE_SHIFT_KEY(qu_excl, &kp QMARK, &kp EXCL)
    DEFINE_SHIFT_KEY(redo, &kp K_UNDO, &kp K_REDO)
	
	
	
        hml: home_row_mod_left {
            compatible = "zmk,behavior-hold-tap";
            #binding-cells = <2>;
            flavor = "balanced";
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            bindings = <&kp>, <&kp>;

            require-prior-idle-ms = <150>;
            hold-trigger-key-positions = <10 11 12 13 14>;
            hold-trigger-on-release;
        };

        hmr: home_row_mod_right {
            compatible = "zmk,behavior-hold-tap";
            #binding-cells = <2>;
            flavor = "balanced";
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            bindings = <&kp>, <&kp>;

            require-prior-idle-ms = <150>;
            hold-trigger-key-positions = <15 16 17 18 19>;
            hold-trigger-on-release;
		};
    };

// ╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
// │ C O M B O S                                                                                                                                       │
// ╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
// 					                                     38 KEY MATRIX / LAYOUT MAPPING
//												    ╭────────────────────┬────────────────────╮ 
//												    │  0   1   2   3   4 │  5   6   7   8   9 │
//						 						 ╭──╯ 10  11  12  13  14 │ 15  16  17  18  19 ╰───╮
//						 						 │ 20 21  22  23  24  25 │ 26  27  28  29  30  31 │
//												 ╰──────────╮ 32  33  34 │ 35  36  37 ╭───────────╯
//							            					╰────────────┴────────────╯

    combos {
        compatible = "zmk,combos";

//Left Hand Symbols
		COMBO(at, &kp AT, 1 11, 0 1 2 3)
		COMBO(hash, &kp HASH, 2 12, 0 1 2 3)
		COMBO(dllr, &kp DLLR, 3 13, 0 1 2 3)
		COMBO(prcnt, &kp PRCNT, 4 14, 0 1 2 3)

		COMBO(grave, &kp GRAVE, 11 22, 0 1 2 3)
		COMBO(bslh, &kp BSLH, 12 23, 0 1 2 3)
		COMBO(equal, &kp EQUAL, 13 24, 0 1 2 3)
		COMBO(tilde, &kp TILDE, 14 25, 0 1 2 3)	

//Right Hand Symbols		
		COMBO(caret, &kp CARET, 5 15, 0 1 2 3)
		COMBO(plus, &kp PLUS, 6 16, 0 1 2 3)
		COMBO(star, &kp STAR, 7 17, 0 1 2 3)
		COMBO(amps, &kp AMPS, 8 18, 0 1 2 3)

		COMBO(under, &kp UNDER, 15 26, 0 1 2 3)
		COMBO(minus, &kp MINUS, 16 27, 0 1 2 3)
		COMBO(fslh,  &kp FSLH, 17 28, 0 1 2 3)
		COMBO(pipe,  &kp PIPE, 18 29, 0 1 2 3)

//functions
        COMBO(copy, &kp LC(INS), 22 23, 0 1 2 3)
		COMBO(paste, &kp LS(INS), 23 24, 0 1 2 3)
		COMBO(cut, &kp LC(X), 22 24, 0 1 2 3)
		COMBO(caps, &kp CAPS, 13 16, 0 1 2 3 4)
		COMBO(undo, &kp K_UNDO, 20 21, 0 1 2 3)
		COMBO(redo, &kp K_REDO, 30 31, 0 1 2 3)
    };

	conditional_layers {
        compatible = "zmk,conditional-layers";

        sys_layer {
            if-layers = <1 2>;
            then-layer = <6>;
        };
	};


    keymap {
        compatible = "zmk,keymap";

        Base {
            display-name = "Base";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
					 &kp Q         &kp W         &kp E         &kp R         &kp T        	  &kp Y    	    &kp U         &kp I         &kp O         &kp P
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
				  &hml LGUI A  	&hml LALT S   &hml LCTRL D   &hml LSHFT F  	 &kp G        	  &kp H    	  &hmr RSHFT J  &hmr RCTRL K  &hmr RALT L  &hmr RGUI SEMICOLON
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	&kp ESCAPE  	&kp Z          &kp X       	 &kp C         &kp V         &kp B        	  &kp N    	    &kp M       &kp COMMA      &kp DOT      &kp SLASH   	&kp APOSTROPHE
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
											   &lt 2 LSHFT    &lt 1 TAB    &lt 5 SPACE    	  &kp RET  		&kp DEL    	&kp BSPC 
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };

Nav {
    display-name = "Nav";
    bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
					&kp COMMA    &kp NUMBER_7  &kp NUMBER_8  &kp NUMBER_9  &kp LBRC      	 &kp RBRC     	&kp PG_UP		___       	&kp PG_DN		___
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
					&kp DOT  	 &kp NUMBER_4  &kp NUMBER_5  &kp NUMBER_6  &kp LBKT			 &kp RBKT     	NAV_LEFT      NAV_UP        NAV_RIGHT    	___
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	&kp LS(TAB)   &kp NUMBER_0  &kp NUMBER_1  &kp NUMBER_2  &kp NUMBER_3	&kp LPAR     	 &kp RPAR      &kp HOME      &kp DOWN    	&kp END      	___           ___
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
                                                   ___           ___           ___           	___	   		NAV_DEL		 NAV_BSPC
// 											 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
    >;
};


//GAME LAYER GATEWAY
        Fun {
            display-name = "Fun";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
					&kp F12  	   &kp F8   	 &kp F8   	  &kp F9  		  ___	 	 	  ___   		___  	  	&kp C_VOL_UP	  ___		&kp LA(F4)
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
					&kp F11        &kp F4   	 &kp F5       &kp F6   		  ___    		  ___  	  		DSK_PREV	&kp C_VOL_DN	DSK_NEXT		___
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	   ___  		&kp F10        &kp F1  		 &kp F2   	  &kp F3   		  ___    		  PIN_APP		PIN_WIN		&kp C_MUTE		  ___			___			 &to 3 
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
												  ___ 	  		___  		  ___    		  ___  	  		___  		  ___
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };

        Gaming {
            display-name = "Game";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
					 &kp Q         &kp W  		 &kp E         &kp R		 &kp T     		 &kp Y  	   &kp U  		 &kp I  	  &kp O  		 &kp P
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
					 &kp A         &kp S  		 &kp D         &kp F         &kp G     		 &kp H  	   &kp J  		 &kp K  	  &kp L  		 &sl 5
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	 &kp ESCAPE  	 &kp Z    	   &kp X  		 &kp C         &kp V         &kp B     		 &kp N  	   &kp M  	   &kp COMMA   	  &kp DOT 	   &kp SLASH   	  &to 0
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
												  &sl 4  	   &kp TAB	      ___     		  ___	   	     ___  		  &sl 4
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };

        Gaming+ {
            display-name = "Game+";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
				 &kp NUMBER_1   &kp NUMBER_2  &kp NUMBER_3  &kp NUMBER_4 &kp NUMBER_5    	  ___ 		    ___    		  ___  	  		___  	 	  ___
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
				 &kp NUMBER_6  &kp NUMBER_7  &kp NUMBER_8  &kp NUMBER_9  &kp NUMBER_0	 	  ___        	___        	  ___  	  		___ 		  ___
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	 &kp GRAVE  	&kp F1    	  &kp F2        &kp F3         &kp F4        &kp F5           ___       	___       	  ___  	  		___  		  ___   	 	___
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
												  ___           ___           ___     	      ___        	___       	  ___
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };
		
		Mouse {
            display-name = "Mouse";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
				      ___  	      	___  		  ___  	  		___  		  ___    		 &mkp MB4     	&mkp MB1  	  &mkp MB3  	&mkp MB2	  &mkp MB5
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
					&kp LGUI      &kp LALT     &kp LCTRL  	 &kp LSHFT		  ___    	 &msc SCRL_LEFT  &mmv MOVE_LEFT  &mmv MOVE_UP  &mmv MOVE_RIGHT  &msc SCRL_RIGHT
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	    ___  		  ___       	___  		  ___  	  		___  		  ___    		 ___  	  		  ___      &mmv MOVE_DOWN     ___   		___   	  	  ___
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
												  ___  	  		___  		  ___   		&msc SCRL_UP   &msc SCRL_DOWN   ___
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };
		
		Sys {
            display-name = "Sys";
            bindings = <
//				 ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮  ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
						XXX  		 XXX  		   XXX  		 XXX      &studio_unlock    &studio_unlock    XXX 	  	  	XXX  	   	  XXX  	        XXX
//				 ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
				  &bt BT_SEL 0	 &bt BT_SEL 1  &bt BT_SEL 2  &bt BT_SEL 3  	&bt BT_CLR    	 &bt BT_CLR  &bt BT_SEL 3  &bt BT_SEL 2  &bt BT_SEL 1  &bt BT_SEL 0
// ╭─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┼─────────────╮
	&bootloader  	  XXX           XXX  		  XXX  	  	 &bt BT_PRV  	&bt BT_NXT    	&bt BT_NXT 	  &bt BT_PRV 		XXX  	   	  XXX   		XXX  	  &bootloader 
// ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┼─────────────┤  ├─────────────┼─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
												  ___  	  		___ 		  ___   		   ___  	    ___  		  ___
//                            				 ╰─────────────┴─────────────┴─────────────╯  ╰─────────────┴─────────────┴─────────────╯
            >;
        };
		
    };
};
